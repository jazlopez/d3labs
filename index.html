<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3 Lab</title>

    <style>

        .bar {
            fill: lightblue;
            fill-opacity: 0.9;
            stroke-width: 1px;
            stroke-dasharray: 1;
        }

        .axis path, .axis line { fill: none; stroke: #eee; shape-rendering: crispEdges; } .axis text { font-size: 11px; }

        * {
            text-align: center;
            font-weight: 400;
        }

        .ipsum {
            font-size: 11px;
            font-family: "Andale Mono";
            background: #eeeeee;
            color: dimgray;
            padding: 2%;
            border-radius: 4px;
            font-style: italic;
        }
    </style>
</head>
<body>


<cite>
    <sub>jlopez.mx,Software Developer , D3 Labs</sub>
</cite>

<hr/>

<div id="container"></div>

<script type="application/javascript" src="node_modules/d3/build/d3.min.js"></script>

<script type="application/javascript">
    "use strict";

    (function() {

        var data = [

            {region: 'north', y: 140},

            {region: 'northwest', y: 120},

            {region: 'northeast', y: 40},

            {region: 'south', y : 200},

            {region: 'southwest', y: 130},

            {region: 'southeast', y: 100}


        ];

        var

            offset = 20,

            width = 600,

            height = 480,

            margin = 50,

            msTransitionDelay = 800;

        var container = document.querySelector('#container');

        // add the graph canvas to the body of the web page

        // translate 0, 20 svg to add some space as margin bottom

        var svg = d3.select(container).append("svg")

            .attr("width", width)

            .attr("height", height)

            .append("g")

            .attr('transform', 'translate(0,' + offset +')');


        /**
         * Scale (data)
         * @type {{x: *, y: *}}
         */
        var scales = {
            x: d3.scaleBand().domain(data.map(function(d){ return d.region})).rangeRound([ margin, width]) .padding( 0.1),

            y: d3. scaleLinear() .domain([ 0, d3. max(data, function(d){ return d.y})]).range([(height - margin), 0])
        };

        /**
         * Axis x
         * @type {*|void}
         */
        var xAxis = d3. axisBottom(). scale(scales.x);

        /**
         * Axis y
         * @type {*|void}
         */
        var yAxis = d3.axisLeft().scale(scales.y);

        /**
         * For each axis append g element
         * x axis bottom
         * y axis left
         */
        svg.append('g') .attr('class', 'axis')
             .attr('transform', 'translate(0, ' + (height - margin)+')') .call( xAxis);

        svg.append('g') .attr('class', 'axis')
             .attr('transform', 'translate(' + margin +', 0)') .call( yAxis);


        /**
         * For each data point append rectangle (bar)
         */
        svg.selectAll('rect')

            .data(data)

            .enter()

            .append('rect')

            .attr('x', function(d){

                return scales.x(d.region);
            })

            .attr('y', function(d){

                // static
                // return scales.y(d.y)

                // transition (initial y axis at bottom)
                return (height - margin);
            })

            .attr('class', 'bar') // set CSS for this element

            .attr('width', scales.x.bandwidth()) // set width of `x axis` elements

            .attr('height', function(d){

                // static
                // return (height - margin )- scales.y(d.y);

                // transition (initial state height equals to zero
                return 0;
            })

            .transition() // enable transition

            .delay(function(d,i){ // during 800 ms after page is load `height` of y `axis`

                return i * msTransitionDelay;
            })

            .duration(msTransitionDelay) // fpr the next 800 ms after `delay` each bar moves up rom zero to `value` of `y axis`

            .attr('y', function(d){  // actual `data point` of `y axis` ( when transition completes)

                return scales.y(d.y)
            })
            .attr('height', function(d){ // actual `height` of `y axis` ( when transition completes)

                return (height - margin )- scales.y(d.y);
            });

        // add some element with d3.select example
        d3.select('#container')

            .append('div')

            .attr('class', 'ipsum')

            .text(
                'Manipulating content We can do far more with D3 than just playing around with selections and ' +
                'changing the properties of the elements. We can change the properties of elements on the page. ' +
                'With D3, we can change the contents of an element, add new elements, or remove elements ' +
                'we don\'t want.');

    })();

</script>
</body>
</html>